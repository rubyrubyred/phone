<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>OCèŒç³»å¤å¤åƒç´ æ‰‹æœºæ¨¡æ‹Ÿå™¨</title>
  <style>
    @font-face {
      font-family: 'FZG_CN-1';
      src: url('https://cdn.jsdelivr.net/gh/rubyrubyred/test@main/FZG_CN-1.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }
    :root {
      /* mimi.htmlèŒç³»é…è‰²æ–¹æ¡ˆ */
      --sweet-pink: #F8C8D7;   /* ä¸»ç”œç²‰ */
      --soft-white: #FFFFFF;   /* ä¸»èƒŒæ™¯è‰² */
      --lace-cream: #FFF5F7;   /* æ¬¡è¦èƒŒæ™¯/é˜´å½±è‰² */
      --crystal-pink: #ECA0B0; /* è£…é¥°/æŒ‰é’®é»˜è®¤è‰² */
      --muted-grey: #606060;   /* æ­£æ–‡æ–‡æœ¬é¢œè‰² */
      /* å…¼å®¹åŸæœ‰å˜é‡ */
      --primary-pink: var(--sweet-pink);
      --primary-white: var(--soft-white);
      --primary-light-pink: var(--lace-cream);
      --primary-deep-pink: var(--crystal-pink);
      --aux-brown: var(--crystal-pink);
      --aux-pink: var(--sweet-pink);
      --text-dark: var(--muted-grey);
      --pixel-shadow: 0 4px 0 0 var(--crystal-pink), 0 8px 8px 0 rgba(236, 160, 176, 0.1), 4px 0 0 0 var(--lace-cream), 0 0 0 4px var(--soft-white);
    }
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: var(--sweet-pink);
      font-family: 'FZG_CN-1', Arial, sans-serif !important;
      color: var(--text-dark);
      box-sizing: border-box;
    }
    .simulator-main {
      max-width: 390px; /* è°ƒæ•´ä¸ºæ›´æ¥è¿‘çœŸå®æ‰‹æœºçš„å®½åº¦ï¼ˆiPhone 13/14ï¼‰ */
      margin: 60px auto 40px auto;
      background: url('https://cdn.jsdelivr.net/gh/rubyrubyred/img@main/back.png');
      background-repeat: repeat;
      background-size: auto;
      padding: 35px 15px 90px 15px; /* è°ƒæ•´å†…è¾¹è·ä»¥é…åˆæ–°å°ºå¯¸ */
      border-radius: 45px; /* é€‚å½“å¢å¤§åœ†è§’ä»¥é…åˆæ–°å°ºå¯¸ */
      /* æ‰‹æœºè¾¹æ¡†æ•ˆæœ - ä¸‰å±‚ç²‰è‰²è¾¹æ¡† */
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15), 0 0 0 7px #FF1493; /* è°ƒæ•´è¾¹æ¡†å¤§å° */
      border: 7px solid #FF69B4; /* è°ƒæ•´è¾¹æ¡†å¤§å° */
      outline: 7px solid #FFB6C1; /* è°ƒæ•´è¾¹æ¡†å¤§å° */
      outline-offset: -7px; /* è°ƒæ•´è¾¹æ¡†åç§»ä»¥é…åˆæ–°å¤§å° */
      position: relative;
      min-height: 844px; /* è°ƒæ•´ä¸ºæ›´æ¥è¿‘çœŸå®æ‰‹æœºçš„é«˜åº¦ï¼ˆiPhone 13/14ï¼‰ */
      box-sizing: border-box;
    }
    /* æ‰‹æœºé¡¶éƒ¨å¬ç­’ */
    .simulator-main::before {
      content: '';
      position: absolute;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 6px;
      background: #333;
      border-radius: 3px;
    }
    /* æ‰‹æœºé¡¶éƒ¨æ‘„åƒå¤´ */
    .simulator-main::after {
      content: '';
      position: absolute;
      top: 13px;
      left: calc(50% + 60px);
      width: 10px;
      height: 10px;
      background: #333;
      border-radius: 50%;
    }

    /* æ‰‹æœºçŠ¶æ€æ æ ·å¼ */
    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 15px;
      background: var(--soft-white);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      margin-bottom: 15px;
      font-size: 0.9em;
      color: var(--muted-grey);
    }

    .status-left, .status-right {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .signal-icon, .wifi-icon, .battery-icon {
      font-size: 1.1em;
    }

    .status-time {
      font-weight: 500;
      font-size: 0.95em;
      color: var(--crystal-pink);
    }
    .pixel-deco {
      position: absolute;
      width: 32px;
      height: 32px;
      z-index: 1;
    }
    .heart { top: 12px; right: 12px; }
    .ribbon { top: 12px; left: 12px; }
    .cake { bottom: 90px; right: 12px; } /* è°ƒæ•´è£…é¥°ä½ç½® */
    .pixel-title {
      font-size: 1.2em;
      font-weight: bold;
      color: var(--aux-brown);
      margin: 0 0 1em 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    /* æ–°å¢ï¼šæ¬¢è¿è¯­æ ·å¼ */
    .welcome-text {
      text-align: center;
      color: var(--aux-pink);
      font-size: 1.1em;
      margin: 20px 0 30px 0;
      font-weight: bold;
      text-shadow: 1px 1px 0 var(--aux-brown);
    }
    .space-between {
      display: flex;
      justify-content: space-between;
    }
    .pixel-card {
      background: rgba(255, 255, 255, 0.95);
      /* åƒç´ åŒ–åœ†è§’ï¼ˆ8pxåƒç´ é£ï¼‰ */
      border-radius: 8px;
      padding: 16px;
      box-shadow: var(--pixel-shadow);
      /* åƒç´ åŒ–è¾¹æ¡† */
      border: 3px solid var(--aux-brown);
      /* å¡ç‰‡äº¤äº’åŠ¨æ•ˆ */
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    .pixel-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 0 0 var(--aux-brown), 0 10px 12px 0 rgba(112, 66, 65, 0.15), 4px 0 0 0 var(--primary-deep-pink), 0 0 0 4px var(--primary-white);
    }
    .pixel-input {
      padding: 8px 12px;
      /* åƒç´ åŒ–è¾“å…¥æ¡†è¾¹æ¡† */
      border: 3px solid var(--aux-brown);
      border-radius: 8px;
      font-family: inherit;
      font-size: 1em;
      background: var(--primary-white);
      color: var(--text-dark);
      flex: 1;
      margin-right: 8px;
      /* è¾“å…¥æ¡†äº¤äº’åŠ¨æ•ˆ */
      transition: all 0.2s;
    }
    .pixel-input:focus {
      outline: none;
      border-color: var(--aux-pink);
      box-shadow: 0 0 0 2px var(--primary-light-pink);
    }
    .pixel-btn {
      padding: 8px 16px;
      border: 3px solid var(--aux-brown);
      border-radius: 8px;
      background: var(--primary-light-pink);
      color: var(--aux-brown);
      font-family: inherit;
      font-size: 1em;
      cursor: pointer;
      /* æŒ‰é’®äº¤äº’åŠ¨æ•ˆ */
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      /* åƒç´ åŒ–æŒ‰é’® */
      box-shadow: 0 3px 0 0 var(--aux-brown);
    }
    .pixel-btn:hover {
      background: var(--aux-pink);
      color: var(--primary-white);
      transform: translateY(-2px);
      box-shadow: 0 5px 0 0 var(--aux-brown);
    }
    .pixel-btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 0 0 var(--aux-brown);
    }
    .row {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      align-items: center;
    }
    .app-grid { 
      display: flex; 
      flex-wrap: nowrap; 
      gap: 12px; /* å‡å°é—´è·ä»¥ç¼©ç´§appæ’åˆ— */
      justify-content: center; 
      align-items: center;
      position: absolute;
      bottom: 70px; /* è°ƒæ•´åº•éƒ¨ä½ç½® */
      left: 0;
      width: 100%;
      padding: 8px 0; /* å‡å°å†…è¾¹è· */
      background: rgba(255, 255, 255, 0.9);
      border-top: 2px solid var(--aux-brown);
    }
    .app-icon-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: auto;
      cursor: pointer;
      /* å›¾æ ‡äº¤äº’åŠ¨æ•ˆ */
      transition: transform 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    .app-icon-btn:hover {
      transform: scale(1.1) rotate(2deg);
    }
    /* Emojiå›¾æ ‡å¤–æ–¹å—æ ·å¼ */
    .app-icon-img {
      width: 40px; /* å‡å°å›¾æ ‡å°ºå¯¸ */
      height: 40px;
      margin-bottom: 4px; /* å‡å°é—´è· */
      /* åƒç´ åŒ–æ–¹å—èƒŒæ™¯ */
      background: var(--primary-white);
      border: 3px solid var(--aux-brown);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      /* å›¾æ ‡é˜´å½± */
      box-shadow: 0 3px 0 0 var(--aux-brown);
    }
    /* GIFå›¾æ ‡ç‰¹å®šæ ·å¼ */
    .app-icon-img img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    .app-icon-label {
      font-size: 0.8em; /* å‡å°å­—ä½“å¤§å°ä»¥é…åˆç¼©ç´§çš„æ’åˆ— */
      color: var(--aux-brown);
      text-align: center;
    }
    .app-panel { 
      display: none; 
      animation: fadein-app 320ms ease-out; 
      background: transparent; 
      z-index: 7; 
      margin-bottom: 16px;
    }
    .app-panel.active { 
      display: block; 
    }
    @keyframes fadein-app {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* ä¿®æ”¹ï¼šåº•éƒ¨Homeé”®æ ·å¼ - å›ºå®šåœ¨æœ€åº•éƒ¨ */
    .bottom-bar {
      position: absolute;
      bottom: 20px;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: center;
    }
    .home-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 4px solid var(--aux-brown);
      background: var(--primary-light-pink);
      color: var(--aux-brown);
      font-size: 1.5em;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 0 var(--aux-brown);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .home-btn:hover {
      background: var(--aux-pink);
      color: var(--primary-white);
      transform: translateY(-3px);
      box-shadow: 0 6px 0 var(--aux-brown);
    }
    .home-btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 0 var(--aux-brown);
    }
    /* ç»å…¸9é”®æ‹¨å·é”®ç›˜æ ·å¼ */
    .dial-pad {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin: 15px 0;
    }
    .dial-btn {
      padding: 15px 0;
      border: 3px solid var(--aux-brown);
      border-radius: 8px;
      background: var(--primary-light-pink);
      color: var(--aux-brown);
      font-family: inherit;
      font-size: 1.2em;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 3px 0 0 var(--aux-brown);
    }
    .dial-btn:hover {
      background: var(--aux-pink);
      color: var(--primary-white);
      transform: translateY(-2px);
      box-shadow: 0 5px 0 0 var(--aux-brown);
    }
    /* èŠå¤©è®°å½•æ ·å¼ */
    .chat-container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 10px;
      min-height: 200px;
      max-height: 300px;
      overflow-y: auto;
      border: 2px solid var(--aux-brown);
    }
    .chat-message {
      margin-bottom: 8px;
      max-width: 80%;
      padding: 8px 12px;
      border-radius: 18px;
      clear: both;
      border: 2px solid var(--aux-brown);
    }
    .received {
      background: var(--primary-pink);
      color: var(--text-dark);
      float: left;
      border-bottom-left-radius: 4px;
    }
    .sent {
      background: var(--primary-deep-pink);
      color: var(--primary-white);
      float: right;
      border-bottom-right-radius: 4px;
    }
    .chat-time {
      font-size: 0.7em;
      opacity: 0.8;
      margin-left: 8px;
    }
    /* æ—¥å†æ ·å¼ä¼˜åŒ– - æ˜¾ç¤ºçœŸå®æ—¥å† */
    .calendar-date-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .calendar-date-btn {
      padding: 3px 6px;
      border: 2px solid var(--aux-brown);
      border-radius: 6px;
      background: var(--primary-light-pink);
      color: var(--aux-brown);
      font-family: inherit;
      cursor: pointer;
      box-shadow: 0 2px 0 0 var(--aux-brown);
      font-size: 0.8em;
    }
    /* åƒç´ é£æ ¼æ—¥å†ç½‘æ ¼ */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 15px;
    }
    .calendar-day {
      text-align: center;
      padding: 6px 0;
      font-size: 0.9em;
      color: var(--aux-brown);
      font-weight: bold;
    }
    .calendar-date {
      text-align: center;
      padding: 6px 0;
      border-radius: 6px;
      font-size: 0.9em;
      transition: all 0.2s;
      border: 2px solid transparent;
      cursor: pointer;
    }
    .calendar-date.today {
      background: var(--aux-pink);
      color: var(--primary-white);
      border-color: var(--aux-brown);
      font-weight: bold;
    }
    .calendar-date.selected {
      background: var(--primary-light-pink);
      border-color: var(--aux-brown);
      font-weight: bold;
    }
    .calendar-date.other {
      opacity: 0.5;
    }
    .calendar-date:hover:not(.today):not(.selected) {
      background: var(--primary-pink);
      border-color: var(--aux-brown);
    }
    /* æ–°å¢ï¼šæ—¥ç¨‹åˆ—è¡¨é¡¹æ ·å¼ï¼Œç¡®ä¿åˆ é™¤æŒ‰é’®å›ºå®šåœ¨å³ä¾§ */
    .calendar-item {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
      justify-content: space-between;
    }
    .calendar-item-text {
      flex: 1;
      padding-right: 10px;
    }
    .contact-avatar {
      width: 32px;
      height: 32px;
      margin-right: 10px;
      border: 2px solid var(--aux-brown);
      border-radius: 6px;
    }
    /* æœºä¸»å¤´åƒæ ·å¼ - ä¼˜åŒ–å°ºå¯¸å’Œæ˜¾ç¤ºï¼Œç¡®ä¿emojiå±…ä¸­ */
    .profile-avatar {
      width: 70px;
      height: 70px;
      border: 4px solid var(--aux-brown);
      border-radius: 8px;
      margin: 0 auto 15px auto;
      background: var(--primary-pink);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px; /* å‡å°é»˜è®¤å¤´åƒæ–‡å­—å¤§å° */
      box-shadow: 0 4px 0 0 var(--aux-brown);
      object-fit: cover; /* ç¡®ä¿å›¾ç‰‡æ­£ç¡®æ˜¾ç¤º */
      line-height: 1; /* å…³é”®ï¼šæ¶ˆé™¤è¡Œé«˜å½±å“ */
      text-align: center; /* ç¡®ä¿æ–‡å­—å±…ä¸­ */
    }
    /* è®¾ç½®é¡µé¢å¸ƒå±€ä¼˜åŒ– */
    .profile-info {
      margin: 10px 0;
      text-align: center;
    }
    .profile-label {
      font-size: 0.9em;
      color: var(--aux-brown);
      margin-right: 5px;
    }
    .profile-value {
      font-size: 1em;
      font-weight: bold;
      color: var(--aux-pink);
    }
    .profile-input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin: 15px 0;
    }
    #loading-pixel-heart {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
      transition: opacity 0.3s;
    }
    /* åƒç´ åŒ–æ»šåŠ¨æ¡ */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: var(--primary-pink);
      border-radius: 0;
    }
    ::-webkit-scrollbar-thumb {
      background: var(--primary-deep-pink);
      border-radius: 0;
      border: 2px solid var(--aux-brown);
    }
    ::-webkit-scrollbar-thumb:hover {
      background: var(--aux-pink);
    }
    /* éšè—æ–‡ä»¶è¾“å…¥æ¡† */
    .file-input-hidden {
      display: none;
    }
    /* ç›¸å†Œå›¾ç‰‡1:1å±•ç¤ºæ ·å¼ */
    .gallery-image-container {
      width: 100px;
      height: 100px;
      border-radius: 8px;
      border: 2px solid #704241;
      background: #fff;
      margin-right: 10px;
      overflow: hidden;
    }
    .gallery-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      image-rendering: pixelated;
    }
  </style>
</head>
<body>
  <!-- Loading åŠ¨ç”»: åƒç´ å°çˆ±å¿ƒé€å¸§æ˜¾ç¤º -->
  <div id="loading-pixel-heart">
    <canvas class="pixel-heart-frame" width="48" height="48"></canvas>
  </div>

  <div class="simulator-main">
    <!-- æ‰‹æœºçŠ¶æ€æ  -->
    <div class="status-bar">
      <div class="status-left">
        <span class="signal-icon">ğŸ“¶</span>
        <span class="wifi-icon">ğŸ“¡</span>
      </div>
      <div class="status-center">
        <span id="clock" class="status-time">--:--</span>
      </div>
      <div class="status-right">
        <span class="battery-icon">ğŸ”‹</span>
      </div>
    </div>

    <!-- åƒç´ è£…é¥°ä¾‹å­ï¼ˆå¯å¢åˆ ï¼‰ -->
    <div class="pixel-deco heart"></div>
    <div class="pixel-deco ribbon"></div>
    <div class="pixel-deco cake"></div>

    <!-- æ¨¡æ‹Ÿå™¨é¡¶æ  -->
    <div class="pixel-title space-between" style="margin-bottom: 1.5em;">
      <span>xxzçš„æ‰‹æœº</span>
    </div>

    <!-- æ–°å¢ï¼šæ¬¢è¿è¯­åŒºåŸŸ -->
    <div id="welcome-message" class="welcome-text"></div>

    <!-- ä¸»ç•Œé¢ - åº”ç”¨å›¾æ ‡ç½‘æ ¼ï¼Œé»˜è®¤æ˜¾ç¤ºï¼ˆEmoji+å¤–æ–¹å—ï¼‰ -->
    <div id="app-main" class="app-grid" style="display:flex;">
      <div class="app-icon-btn" onclick="switchApp('phone')" title="ç”µè¯">
        <img class="app-icon-img" src="https://cdn.jsdelivr.net/gh/rubyrubyred/img@main/p%20(58).gif" alt="ç”µè¯">
        <span class="app-icon-label">ç”µè¯</span>
      </div>
      <div class="app-icon-btn" onclick="switchApp('settings')" title="è®¾ç½®">
        <img class="app-icon-img" src="https://cdn.jsdelivr.net/gh/rubyrubyred/img@main/p%20(9).gif" alt="è®¾ç½®">
        <span class="app-icon-label">è®¾ç½®</span>
      </div>
      <div class="app-icon-btn" onclick="switchApp('gallery')" title="ç›¸å†Œ">
        <img class="app-icon-img" src="https://cdn.jsdelivr.net/gh/rubyrubyred/img@main/p%20(17).gif" alt="ç›¸å†Œ">
        <span class="app-icon-label">ç›¸å†Œ</span>
      </div>
      <div class="app-icon-btn" onclick="switchApp('sms')" title="çŸ­ä¿¡">
        <img class="app-icon-img" src="https://cdn.jsdelivr.net/gh/rubyrubyred/img@main/p%20(18).gif" alt="çŸ­ä¿¡">
        <span class="app-icon-label">çŸ­ä¿¡</span>
      </div>
      <div class="app-icon-btn" onclick="switchApp('contacts')" title="è”ç³»äºº">
        <img class="app-icon-img" src="https://cdn.jsdelivr.net/gh/rubyrubyred/img@main/p%20(76).gif" alt="è”ç³»äºº">
        <span class="app-icon-label">è”ç³»äºº</span>
      </div>
      <div class="app-icon-btn" onclick="switchApp('calendar')" title="æ—¥ç¨‹è¡¨">
        <img class="app-icon-img" src="https://cdn.jsdelivr.net/gh/rubyrubyred/img@main/p%20(28).gif" alt="æ—¥ç¨‹">
        <span class="app-icon-label">æ—¥ç¨‹</span>
      </div>
    </div>

    <!-- å„åº”ç”¨é¢æ¿ï¼Œé»˜è®¤éšè—ï¼Œé€‰ä¸­æ‰æ˜¾ç¤º -->
    <div id="app-phone" class="pixel-card app-panel">
      <div class="pixel-title">ç”µè¯ <span style="margin-left:9px;">ğŸ“</span></div>
      <div class="row" style="margin-bottom:9px;">
        <input id="dial-input" class="pixel-input" type="tel" maxlength="15" placeholder="è¾“å…¥å·ç ">
        <button class="pixel-btn" onclick="simulateCall()">æ‹¨æ‰“</button>
      </div>
      <!-- ç»å…¸9é”®æ‹¨å·é”®ç›˜ -->
      <div class="dial-pad">
        <button class="dial-btn" onclick="inputDial('1')">1</button>
        <button class="dial-btn" onclick="inputDial('2')">2</button>
        <button class="dial-btn" onclick="inputDial('3')">3</button>
        <button class="dial-btn" onclick="inputDial('4')">4</button>
        <button class="dial-btn" onclick="inputDial('5')">5</button>
        <button class="dial-btn" onclick="inputDial('6')">6</button>
        <button class="dial-btn" onclick="inputDial('7')">7</button>
        <button class="dial-btn" onclick="inputDial('8')">8</button>
        <button class="dial-btn" onclick="inputDial('9')">9</button>
        <button class="dial-btn" onclick="inputDial('*')">*</button>
        <button class="dial-btn" onclick="inputDial('0')">0</button>
        <button class="dial-btn" onclick="inputDial('#')">#</button>
      </div>
      <button class="pixel-btn" style="width:100%;margin-bottom:10px;" onclick="document.getElementById('dial-input').value = ''">æ¸…ç©ºå·ç </button>
      <div style="margin-top:11px;">
        <div style="font-size:1.04em;color:var(--aux-brown);font-weight:bold;margin-bottom:4px;">é€šè¯è®°å½•</div>
        <ul id="call-history" style="list-style:none;padding-left:0;"></ul>
      </div>
    </div>
    
    <div id="app-settings" class="pixel-card app-panel">
      <div class="pixel-title">è®¾ç½® <span style="margin-left:10px;">ğŸ› ï¸</span></div>
      <!-- ä¼˜åŒ–è®¾ç½®é¡µé¢å¸ƒå±€ - åˆ é™¤äº†"ä¸ªäººå¤´åƒ"æ–‡å­— -->
      <div style="text-align: center; margin-bottom: 15px;">
        <!-- æœºä¸»å¤´åƒå±•ç¤º -->
        <img id="profile-avatar" class="profile-avatar" src="" alt="" onerror="this.onerror=null; this.src='';">
        <!-- å¤´åƒä¸Šä¼ æŒ‰é’® -->
        <div style="margin-top: 10px;">
          <input type="file" id="avatar-upload" accept="image/*" class="file-input-hidden" onchange="uploadAvatar()">
          <button class="pixel-btn" onclick="document.getElementById('avatar-upload').click()">ä¸Šä¼ å¤´åƒ</button>
        </div>
      </div>
      
      <!-- ä¸ªäººä¿¡æ¯å±•ç¤º - ä¼˜åŒ–å¸ƒå±€å’Œæ–‡å­—å¤§å° -->
      <div class="profile-info">
        <div style="margin-bottom: 8px;">
          <span class="profile-label">æ˜µç§°:</span>
          <span id="profile-name" class="profile-value">OCæœºä¸»</span>
        </div>
        <div style="margin-bottom: 12px;">
          <span class="profile-label">ç­¾å:</span>
          <span id="profile-sign" style="color:var(--aux-brown);">åƒç´ ä¸–ç•Œ ç”œç¾ç”Ÿæ´»~</span>
        </div>
      </div>
      
      <!-- è¾“å…¥æ¡†ç»„ - ä¼˜åŒ–å¸ƒå±€ -->
      <div class="profile-input-group">
        <input id="input-name" class="pixel-input" type="text" maxlength="8" placeholder="æ–°æ˜µç§°">
        <input id="input-sign" class="pixel-input" type="text" maxlength="18" placeholder="æ–°ç­¾å">
        <button class="pixel-btn" onclick="updateProfile()">ä¿å­˜</button>
      </div>
      

    </div>
    
    <div id="app-gallery" class="pixel-card app-panel">
      <div class="pixel-title">
        ç›¸å†Œ <span style="margin-left:9px;">ğŸ“·</span>
      </div>
      <div style="margin-bottom:7px;">
        <input type="file" id="photo-upload" accept="image/*" class="file-input-hidden" onchange="handlePhotoUpload()">
        <input id="photo-desc" class="pixel-input" type="text" maxlength="14" placeholder="å›¾ç‰‡è¯´æ˜">
        <button class="pixel-btn" onclick="document.getElementById('photo-upload').click()">ä¸Šä¼ å›¾ç‰‡</button>
      </div>
      <ul id="gallery-list" style="list-style:none;padding-left:0;margin:0 0 6px 0;"></ul>
    </div>
    
    <div id="app-sms" class="pixel-card app-panel">
      <div class="pixel-title">çŸ­ä¿¡ <span style="margin-left:9px;">ğŸ’Œ</span></div>
      <!-- è”ç³»äººé€‰æ‹©ç•Œé¢ -->
      <div id="sms-contact-selection" style="display:block;">
        <div style="margin-bottom:10px;font-weight:bold;color:var(--aux-pink);">é€‰æ‹©è”ç³»äºº:</div>
        <ul id="sms-contacts-list" style="list-style:none;padding-left:0;margin:0 0 5px 0;"></ul>
      </div>
      <!-- èŠå¤©è®°å½•å®¹å™¨ -->
      <div id="sms-chat" class="chat-container" style="display:none;"></div>
      <!-- èŠå¤©è¾“å…¥åŒºåŸŸ -->
      <div id="sms-input-area" style="margin-top:9px;display:none;">
        <input id="sms-input" class="pixel-input" maxlength="35" type="text" placeholder="æ–°çŸ­ä¿¡å†…å®¹" style="width:100%;margin-bottom:8px;">
        <div style="display:flex;gap:5px;">
          <button class="pixel-btn" onclick="sendSMS()">å‘é€</button>
          <button class="pixel-btn" onclick="backToContactSelection()">è¿”å›</button>
          <!-- æ–°å¢æµ‹è¯•æŒ‰é’®å¸®åŠ©è°ƒè¯• -->
          <button class="pixel-btn" onclick="clearSMS()">æ¸…ç©º</button>
        </div>
      </div>
    </div>
    
    <div id="app-contacts" class="pixel-card app-panel">
      <div class="pixel-title">è”ç³»äºº <span style="margin-left:10px;">ğŸ‘©â€ğŸ¨</span></div>
      <ul id="contacts-list" style="list-style:none;padding-left:0;margin:0 0 5px 0;"></ul>
      <div id="contact-call-history" style="margin-top:12px;"></div>
    </div>
    
    <div id="app-calendar" class="pixel-card app-panel">
      <div class="pixel-title">æ—¥ç¨‹è¡¨ <span style="margin-left:9px;">ğŸ—“ï¸</span></div>
      <div class="calendar-date-bar">
        <button class="calendar-date-btn" onclick="changeDate(-1)">âª å‰ä¸€å¤©</button>
        <span id="calendar-date-label"></span>
        <button class="calendar-date-btn" onclick="changeDate(1)">åä¸€å¤© â©</button>
      </div>
      
      <!-- æ–°å¢çœŸå®æ—¥å†æ˜¾ç¤º -->
      <div id="calendar-grid" class="calendar-grid"></div>
      
      <div id="calendar-list" style="list-style:none;padding-left:2px;"></div>
      <div class="row" style="margin-top:8px;">
        <input id="calendar-input" class="pixel-input" maxlength="22" type="text" placeholder="æ·»åŠ æ—¥ç¨‹" style="flex: 1; margin-right: 8px;">
        <button class="pixel-btn" onclick="addCalendar()">æ·»åŠ </button>
      </div>
    </div>

    <!-- åº•éƒ¨Homeé”® - å›ºå®šåœ¨æœ€åº•éƒ¨ -->
    <div class="bottom-bar">
      <button class="home-btn" onclick="switchApp('main')" title="è¿”å›ä¸»é¡µ"><img src="https://cdn.jsdelivr.net/gh/rubyrubyred/img@main/p%20(64).gif" alt="è¿”å›ä¸»é¡µ" style="width: 100%; height: 100%; object-fit: contain;"></button>
    </div>
  </div>

  <script>
    // ========== åƒç´ çˆ±å¿ƒåŠ è½½åŠ¨ç”» ===========
    const frameData = [
      [ "0000011001100000"+"0001111111110000"+"0011111111111000"+"0111111111111100"+"0111111111111100"+"0111111111111100"+"0011111111111000"+"0001111111110000"+"0000111111100000"+"0000011111000000"+"0000001110000000"+"0000000100000000"+"0000000000000000"+"0000000000000000"+"0000000000000000"+"0000000000000000", ],
      [ "0000011001100000"+"0001111111110000"+"0011111111111000"+"0111111111111100"+"1111111111111110"+"1111111111111110"+"0111111111111100"+"0011111111111000"+"0001111111110000"+"0000111111100000"+"0000011111000000"+"0000001110000000"+"0000000100000000"+"0000000000000000"+"0000000000000000"+"0000000000000000", ],
      [ "0000011001100000"+"0001111111110000"+"0011111111111000"+"1111111111111110"+"1111111111111110"+"1111111111111110"+"1111111111111110"+"0111111111111100"+"0011111111111000"+"0001111111110000"+"0000111111100000"+"0000011111000000"+"0000001110000000"+"0000000100000000"+"0000000000000000"+"0000000000000000", ],
      [ "0000011001100000"+"0011111111111000"+"1111111111111110"+"1111111111111110"+"1111111111111110"+"1111111111111110"+"1111111111111110"+"1111111111111110"+"0111111111111100"+"0011111111111000"+"0001111111110000"+"0000111111100000"+"0000011111000000"+"0000001110000000"+"0000000100000000"+"0000000000000000", ]
    ];
    const pixelColor = "#FF69B4";
    let curFrame = 0;
    let loadingTimer = null;
    function drawPixelHeart(frameIdx) {
      const cvs = document.querySelector('.pixel-heart-frame');
      const ctx = cvs.getContext('2d');
      ctx.clearRect(0, 0, 48, 48);
      let d = frameData[frameIdx%frameData.length][0];
      let step = 3;
      for(let y=0; y<16; ++y) {
        for(let x=0; x<16; ++x) {
          if(d[y*16+x]==='1') {
            ctx.fillStyle = pixelColor;
            ctx.fillRect(x*step, y*step, step, step);
          }
        }
      }
    }
    function showLoadingHeart() {
      curFrame = 0;
      let step = 0;
      drawPixelHeart(0);
      loadingTimer = setInterval(()=>{
        drawPixelHeart(curFrame);
        curFrame = (curFrame+1)%frameData.length;
        step++;
        if(step>10) {
          document.getElementById('loading-pixel-heart').style.opacity = '0';
          setTimeout(()=>document.getElementById('loading-pixel-heart').style.display='none',350);
          clearInterval(loadingTimer);
        }
      }, 165);
    }
    window.addEventListener('DOMContentLoaded', showLoadingHeart);

    // ========== çŠ¶æ€æ æ—¶é—´åˆ·æ–° ============
    function updateClock() {
      var t = new Date();
      var clock = document.getElementById('clock');
      if(clock) {
        var h = t.getHours().toString().padStart(2, '0');
        var m = t.getMinutes().toString().padStart(2, '0');
        clock.textContent = h + ":" + m;
      }
    }
    setInterval(updateClock, 1000);
    updateClock();

    // ========== æ–°å¢ï¼šæ›´æ–°æ¬¢è¿è¯­ ============
    function updateWelcomeMessage() {
      var name = localStorage.getItem('profile-name') || 'xxz';
      var welcomeEl = document.getElementById('welcome-message');
      if (welcomeEl) {
        welcomeEl.textContent = `æ¬¢è¿å›æ¥ï¼Œ${name}ï¼âœ¨`;
      }
    }

    // ========== åº”ç”¨åˆ‡æ¢ ===========
    function switchApp(app) {
      // 1. éšè—æ‰€æœ‰app-panel
      document.querySelectorAll('.app-panel').forEach(function(i){i.classList.remove('active');});
      // 2. æ˜¾ç¤ºä¸»ç•Œé¢å’Œéšè—é¢æ¿
      var mainGrid = document.getElementById('app-main');
      var welcomeMsg = document.getElementById('welcome-message');
      
      if(app === 'main'){
        mainGrid.style.display = 'flex';
        welcomeMsg.style.display = 'block'; // æ˜¾ç¤ºæ¬¢è¿è¯­
        updateWelcomeMessage(); // æ›´æ–°æ¬¢è¿è¯­
      }else{
        mainGrid.style.display = 'none';
        welcomeMsg.style.display = 'none'; // éšè—æ¬¢è¿è¯­
        var target = document.getElementById('app-' + app);
        if(target) target.classList.add('active');
        // åˆ‡æ¢åˆ°æ—¥å†åº”ç”¨æ—¶é‡æ–°æ¸²æŸ“æ—¥å†
        if(app === 'calendar') {
          renderCalendarGrid();
        }
      }
    }
    // é»˜è®¤æ‰“å¼€å³æ˜¾ç¤ºä¸»ç•Œé¢
    switchApp('main');

    // ========== ç”µè¯åº”ç”¨ï¼ˆå®Œå–„é€šè¯è®°å½•ï¼‰ ===========
    function inputDial(d) {
      var inp = document.getElementById('dial-input');
      if(inp) inp.value = (inp.value + d).slice(0,15);
    }
    
    function simulateCall() {
      var inp = document.getElementById('dial-input');
      if(!inp) return;
      var num = inp.value.trim();
      if(!num) {
        alert('è¯·è¾“å…¥å·ç å“¦~ğŸ˜˜');
        return;
      }
      var list = [];
      try { list = JSON.parse(localStorage.getItem('call-history')||'[]'); } catch(e) { list = []; }
      var now = new Date();
      // éšæœºç”Ÿæˆ1-60ç§’çš„é€šè¯æ—¶é•¿
      var durationSeconds = Math.floor(Math.random() * 60) + 1;
      var duration = {
        minutes: Math.floor(durationSeconds / 60),
        seconds: durationSeconds % 60
      };
      // å®Œå–„é€šè¯è®°å½•ä¿¡æ¯ï¼šç²¾ç¡®åˆ°æ—¶åˆ†ç§’ï¼Œæ·»åŠ é€šè¯ç±»å‹å’Œæ—¶é•¿
      list.unshift({
        num: num, 
        time: now.toLocaleString(), 
        contact: getContactName(num),
        callTime: now.toTimeString().substr(0,8), // ç²¾ç¡®åˆ°ç§’
        date: now.toLocaleDateString(),
        type: "å‘¼å‡º", // é€šè¯ç±»å‹ï¼šå‘¼å‡º/å‘¼å…¥
        duration: duration
      });
      localStorage.setItem('call-history', JSON.stringify(list));
      showCallHistory();
      inp.value = '';
    }
    
    function showCallHistory() {
      var list = [];
      try { list = JSON.parse(localStorage.getItem('call-history')||'[]'); } catch(e) { list = []; }
      var box = document.getElementById('call-history');
      if(!box) return;
      box.innerHTML = '';
      
      // å¦‚æœæ²¡æœ‰é€šè¯è®°å½•ï¼Œæ˜¾ç¤ºå¯çˆ±çš„æç¤º
      if(list.length === 0) {
        box.innerHTML = '<li style="text-align: center; color: #FF6B9E; font-size: 0.9em;">è¿˜æ²¡æœ‰é€šè¯è®°å½•å‘¢~ğŸ“±</li>';
        return;
      }
      
      for(var i=0; i<Math.min(list.length, 10); ++i) { // æ˜¾ç¤ºæœ€å¤š10æ¡è®°å½•
        var rec = list[i];
        var contactHTML = rec.contact ? '<b style="color:#FF6B9E;">' + rec.contact + '</b>' : '<span style="color:#704241;">' + rec.num + '</span>';
        
        // æ ¼å¼åŒ–é€šè¯æ—¶é•¿
        var durationText = '';
        if(rec.duration) {
          var minutes = rec.duration.minutes;
          var seconds = rec.duration.seconds;
          if(minutes > 0) {
            durationText = `${minutes}åˆ†${seconds}ç§’`;
          } else {
            durationText = `${seconds}ç§’`;
          }
        } else {
          // ä¸ºæ—§è®°å½•æ·»åŠ é»˜è®¤æ—¶é•¿
          durationText = `${Math.floor(Math.random() * 5) + 1}åˆ†${Math.floor(Math.random() * 60)}ç§’`;
        }
        
        // æ˜¾ç¤ºç²¾ç¡®çš„é€šè¯æ—¶é—´
        var timeStr = rec.callTime || (rec.time && rec.time.length >= 16 ? rec.time.substr(11,8) : '');
        
        // é€‰æ‹©å¯çˆ±çš„emoji
        var callEmoji = rec.type === 'å‘¼å‡º' ? 'ğŸ“' : 'ğŸ“²';
        var cuteEmoji = ['âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'â­'][Math.floor(Math.random() * 4)];
        
        box.innerHTML += '<li><span style="font-size:1.1em;margin-right:6px;color:#FF6B9E;">' + callEmoji + '</span> ' +
          contactHTML + ' ' + cuteEmoji + '<br/>' +
          '<span style="font-size:0.8em;color:#704241;margin-left:22px;">é€šè¯æ—¶é•¿ï¼š' + durationText + ' | ' + rec.type + '</span>' +
          ' <span style="font-size:0.8em;color:#704241;float:right;margin-top:-18px;">â° ' + timeStr + '</span></li>';
      }
    }
    showCallHistory();

    // ========== è®¾ç½®åº”ç”¨ï¼ˆä¿®å¤å¤´åƒä¸Šä¼ å’Œæ˜¾ç¤ºé—®é¢˜ï¼‰ ==========
    // ä¸Šä¼ è‡ªå®šä¹‰å¤´åƒ - ä¿®å¤æ˜¾ç¤ºé—®é¢˜
    function uploadAvatar() {
      const fileInput = document.getElementById('avatar-upload');
      const file = fileInput.files[0];
      if (!file) return;
      
      // éªŒè¯å›¾ç‰‡æ˜¯æ­£æ–¹å½¢
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          if (img.width !== img.height) {
            alert('è¯·ä¸Šä¼ æ­£æ–¹å½¢çš„å›¾ç‰‡ä½œä¸ºå¤´åƒï¼');
            return;
          }
          
          // å°†å›¾ç‰‡è½¬ä¸ºbase64å­˜å‚¨
          localStorage.setItem('custom-avatar', e.target.result);
          // ç«‹å³æ›´æ–°å¤´åƒæ˜¾ç¤º
          const avatarEl = document.getElementById('profile-avatar');
          avatarEl.src = e.target.result;
          avatarEl.textContent = ''; // æ¸…ç©ºemoji
          // æ¸…é™¤é»˜è®¤å¤´åƒçš„å­˜å‚¨
          localStorage.removeItem('profile-avatar');
          fileInput.value = ''; // é‡ç½®æ–‡ä»¶è¾“å…¥
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
    

    
    function updateProfile() {
      var name = document.getElementById('input-name').value.trim();
      var sign = document.getElementById('input-sign').value.trim();
      if(name) localStorage.setItem('profile-name', name);
      if(sign) localStorage.setItem('profile-sign', sign);
      showProfile();
      updateWelcomeMessage(); // æ›´æ–°æ¬¢è¿è¯­
    }
    
    // ä¿®å¤å¤´åƒæ˜¾ç¤ºé€»è¾‘
    function showProfile() {
      var name = localStorage.getItem('profile-name') || 'xxz';
      var sign = localStorage.getItem('profile-sign') || 'Meowæˆ˜é˜Ÿé˜Ÿé•¿';
      var avatar = localStorage.getItem('profile-avatar') || '';
      var customAvatar = localStorage.getItem('custom-avatar');
      
      var pn = document.getElementById('profile-name');
      var ps = document.getElementById('profile-sign');
      var pa = document.getElementById('profile-avatar');
      var inpN = document.getElementById('input-name');
      var inpS = document.getElementById('input-sign');
      
      if(pn) pn.textContent = name;
      if(ps) ps.textContent = sign;
      
      // ä¼˜å…ˆæ˜¾ç¤ºè‡ªå®šä¹‰å¤´åƒ - ä¿®å¤æ˜¾ç¤ºé€»è¾‘
      if (customAvatar) {
        pa.src = customAvatar;
        pa.textContent = '';
        pa.style.display = 'flex'; // ç¡®ä¿æ˜¾ç¤º
      } else {
        pa.src = '';
        pa.textContent = '';
        pa.style.display = 'flex'; // ç¡®ä¿æ˜¾ç¤º
      }
      
      if(inpN) inpN.value = '';
      if(inpS) inpS.value = '';
    }
    showProfile();
    updateWelcomeMessage(); // åˆå§‹åŒ–æ¬¢è¿è¯­

    // ========== ç›¸å†Œåº”ç”¨ï¼ˆæ”¹ä¸ºæœ¬åœ°ä¸Šä¼ ï¼Œ1:1å±•ç¤ºï¼‰ ===========
    function handlePhotoUpload() {
      const fileInput = document.getElementById('photo-upload');
      const file = fileInput.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const desc = document.getElementById('photo-desc').value.trim();
        var list = [];
        try { list = JSON.parse(localStorage.getItem('gallery')||'[]'); } catch(e) { list = []; }
        
        // å­˜å‚¨å›¾ç‰‡çš„base64æ•°æ®å’Œæè¿°
        list.unshift({ 
          data: e.target.result, 
          desc: desc,
          uploadTime: new Date().toLocaleString()
        });
        
        localStorage.setItem('gallery', JSON.stringify(list));
        showGallery();
        document.getElementById('photo-desc').value = '';
        fileInput.value = ''; // é‡ç½®æ–‡ä»¶è¾“å…¥
      };
      reader.readAsDataURL(file);
    }
    
    function showGallery() {
      var list = [];
      try { list = JSON.parse(localStorage.getItem('gallery')||'[]'); } catch(e) { list = []; }
      var box = document.getElementById('gallery-list');
      if(!box) return;
      box.innerHTML='';
      for(let i=0; i<Math.min(list.length,6); ++i) {
        const p = list[i];
        box.innerHTML += 
          `<li style="display:flex;align-items:center;margin-bottom:10px;">
            <div class="gallery-image-container">
              <img src="${p.data}" class="gallery-image" alt="ç›¸å†Œå›¾ç‰‡">
            </div>
            <div style="flex:1;">
              <div style="font-size:0.97em;color:#FF6B9E;">${p.desc || 'æ— æè¿°'}</div>
              <div style="font-size:0.8em;color:#704241;margin-top:4px;">${p.uploadTime || ''}</div>
              <button class="pixel-btn" style="padding:2px 10px;font-size:0.88em;margin-top:4px" onclick="deletePhoto(${i})">åˆ é™¤</button>
            </div>
          </li>`;
      }
    }
    
    function deletePhoto(idx) {
      var list = [];
      try { list = JSON.parse(localStorage.getItem('gallery')||'[]'); } catch(e) { list = []; }
      if(idx>=0 && idx<list.length) list.splice(idx,1);
      localStorage.setItem('gallery', JSON.stringify(list));
      showGallery();
    }
    showGallery();

    // ========== çŸ­ä¿¡åº”ç”¨ï¼ˆæ”¯æŒå¤šè”ç³»äººç‹¬ç«‹å¯¹è¯ï¼‰ ===========
    // å½“å‰é€‰ä¸­çš„è”ç³»äºº
    var currentContact = null;
    
    // æ˜¾ç¤ºè”ç³»äººé€‰æ‹©åˆ—è¡¨
    function showSMSContacts() {
      var contacts = getContacts();
      var box = document.getElementById('sms-contacts-list');
      if(!box) return;
      box.innerHTML = '';
      contacts.forEach(function(c,i){
        box.innerHTML += 
          `<li style="display:flex;align-items:center;margin-bottom:8px;"><img src="${c.avatar}" class="contact-avatar" alt="å¤´åƒ"><span style="font-weight:bold;color:#FF6B9E;">${c.name}</span><span style="color:#704241;margin-left:8px;font-size:0.97em;">${c.num}</span>
          <button class="pixel-btn" style="padding:2px 11px;font-size:0.89em;margin-left:auto;" onclick="selectSMSContact('${c.num}','${c.name}')">èŠå¤©</button></li>`;
      });
    }
    
    // é€‰æ‹©è”ç³»äººå¼€å§‹èŠå¤©
    function selectSMSContact(num, name) {
      currentContact = { num: num, name: name };
      
      // æ˜¾ç¤ºèŠå¤©ç•Œé¢
      document.getElementById('sms-contact-selection').style.display = 'none';
      document.getElementById('sms-chat').style.display = 'block';
      document.getElementById('sms-input-area').style.display = 'flex';
      
      // æ›´æ–°æ ‡é¢˜æ˜¾ç¤ºå½“å‰è”ç³»äºº
      document.querySelector('#app-sms .pixel-title').innerHTML = `ä¸ ${name} èŠå¤© ğŸ’Œ`;
      
      // æ˜¾ç¤ºä¸è¯¥è”ç³»äººçš„èŠå¤©è®°å½•
      showSMS();
    }
    
    // è¿”å›è”ç³»äººé€‰æ‹©ç•Œé¢
    function backToContactSelection() {
      currentContact = null;
      
      // æ˜¾ç¤ºè”ç³»äººé€‰æ‹©ç•Œé¢
      document.getElementById('sms-contact-selection').style.display = 'block';
      document.getElementById('sms-chat').style.display = 'none';
      document.getElementById('sms-input-area').style.display = 'none';
      
      // æ¢å¤åŸæ ‡é¢˜
      document.querySelector('#app-sms .pixel-title').innerHTML = `çŸ­ä¿¡ <span style="margin-left:9px;">ğŸ’Œ</span>`;
    }
    
    // ä¿®å¤çŸ­ä¿¡å‘é€åŠŸèƒ½
    function sendSMS() {
      if(!currentContact) {
        alert('è¯·å…ˆé€‰æ‹©è”ç³»äººï¼');
        return;
      }
      
      var inp = document.getElementById('sms-input');
      var content = inp.value.trim();
      if(!content) {
        alert('è¯·è¾“å…¥çŸ­ä¿¡å†…å®¹ï¼');
        return;
      }
      
      // è·å–è¯¥è”ç³»äººçš„çŸ­ä¿¡è®°å½•
      var smsKey = `sms-list-${currentContact.num}`;
      var smsList = JSON.parse(localStorage.getItem(smsKey) || '[]');
      
      // è·å–å½“å‰æ—¶é—´
      const currentTime = new Date().toLocaleTimeString().substr(0,8);
      
      // æ·»åŠ ç”¨æˆ·å‘é€çš„æ¶ˆæ¯
      smsList.push({ 
        content: content, 
        time: currentTime,
        isSent: true 
      });
      
      // ç«‹å³ä¿å­˜å¹¶æ›´æ–°ç•Œé¢
      localStorage.setItem(smsKey, JSON.stringify(smsList));
      showSMS();
      inp.value = '';
      
      // æ¨¡æ‹Ÿå¯¹æ–¹å›å¤
      setTimeout(() => {
        // ä¸ºä¸åŒè”ç³»äººè®¾ç½®ä¸åŒçš„å›å¤å†…å®¹
        const replies = {
          '11111': ["ä½ å’Œå…”çº¸å’Œå¥½æ²¡ï¼Ÿ", "åˆ°åº•å’Œå¥½æ²¡ï¼Ÿ", "åˆ«æ¯•ä¸šæˆ‘ã€‚", "6", "æ¥ä¸‰è§’æ´²ï¼Ÿ", "è¿™å‘¨æœ«è¿éº¦obå…”çº¸æˆ‘ç»™ä½ ä¸Šèˆ°é•¿ã€‚", "1111111", "æµ‹è¯•ä¸€ä¸‹ä½ æœ‰æ²¡æœ‰æ¯•ä¸šæˆ‘"],
          '22222': ["å¤–å–åƒåœ¾æ”¶ä¸€ä¸‹", "åˆ«å¤©å¤©å…”çº¸è‹±æ˜äº†ï¼Œè¯´äº†çƒ¦", "ï¼Ÿ", "å“¦", "æ‰“æ¸¸æˆå£°éŸ³å°ç‚¹", "å…”çº¸è‹±æ˜å››æŠ“ä½ çœ‹äº†æ²¡"],
          '33333': ["é€€é’±", "èˆ°é•¿ç¤¼æ€ä¹ˆè¿˜ä¸å‘è´§", "tx99", "7799", "ä½ å»298142é—®å§", "æ¯é˜…99", "tzymâ¤ï¸wzx", "ä½ å‰å¤«åˆä¸Šç“œæ ¼äº†"],
          // é»˜è®¤å›å¤
          'default': ["ä½ å¥½å‘€ğŸ˜œ", "æ”¶åˆ°å•¦ï½", "åƒç´ æ‰‹æœºçœŸå¥½ç©ï¼", "ä¸‹æ¬¡å†èŠï½", "å¥½çš„å¥½çš„ğŸ‘Œ"]
        };
        
        // é€‰æ‹©å¯¹åº”è”ç³»äººçš„å›å¤
        const contactReplies = replies[currentContact.num] || replies.default;
        const replyTime = new Date().toLocaleTimeString().substr(0,8);
        
        smsList.push({
          content: contactReplies[Math.floor(Math.random() * contactReplies.length)],
          time: replyTime,
          isSent: false
        });
        
        localStorage.setItem(smsKey, JSON.stringify(smsList));
        showSMS();
      }, 800);
    }
    
    // æ¸…ç©ºçŸ­ä¿¡è®°å½•ï¼ˆè°ƒè¯•ç”¨ï¼‰
    function clearSMS() {
      if(!currentContact) {
        alert('è¯·å…ˆé€‰æ‹©è”ç³»äººï¼');
        return;
      }
      
      var smsKey = `sms-list-${currentContact.num}`;
      localStorage.removeItem(smsKey);
      showSMS();
    }
    
    // ä¿®å¤çŸ­ä¿¡æ˜¾ç¤ºé€»è¾‘
    function showSMS() {
      if(!currentContact) return;
      
      var smsKey = `sms-list-${currentContact.num}`;
      var smsList = JSON.parse(localStorage.getItem(smsKey) || '[]');
      var chatBox = document.getElementById('sms-chat');
      if(!chatBox) return;
      
      // æ¸…ç©ºèŠå¤©æ¡†
      chatBox.innerHTML = '';
      
      // å¦‚æœæ²¡æœ‰æ¶ˆæ¯ï¼Œæ˜¾ç¤ºæç¤º
      if(smsList.length === 0) {
        chatBox.innerHTML = '<div style="text-align: center; color: #FF6B9E; margin-top: 50px; font-size: 0.9em;">è¿˜æ²¡æœ‰å’Œ' + currentContact.name + 'çš„èŠå¤©è®°å½•å‘¢ï½ğŸ“±</div>';
        chatBox.scrollTop = chatBox.scrollHeight;
        return;
      }
      
      // æ˜¾ç¤ºæœ€è¿‘10æ¡æ¶ˆæ¯
      const recentMessages = smsList.slice(-10);
      recentMessages.forEach(function(s) {
        const messageClass = s.isSent ? 'sent' : 'received';
        const sender = s.isSent ? 'æˆ‘' : currentContact.name;
        chatBox.innerHTML += `
          <div class="chat-message ${messageClass}">
            <strong>${sender}:</strong> ${s.content}
            <span class="chat-time">${s.time || ''}</span>
          </div>
        `;
      });
      
      // å¼ºåˆ¶æ»šåŠ¨åˆ°åº•éƒ¨
      chatBox.scrollTop = chatBox.scrollHeight;
    }
    
    // åˆå§‹åŒ–æ˜¾ç¤ºçŸ­ä¿¡è”ç³»äººåˆ—è¡¨
    showSMSContacts();

    // ========== è”ç³»äººåº”ç”¨ ===========
    function getContacts() {
      return [
        { name: "å¤±æ•ˆè¯", num: "11111", avatar: "data:image/svg+xml;utf8,<svg width='38' height='38' xmlns='http://www.w3.org/2000/svg'><ellipse cx='19' cy='20' rx='13' ry='14' fill='%23FFE6F2' stroke='%23704241' stroke-width='3'/><ellipse cx='12' cy='19' rx='2.2' ry='4' fill='%23FFC8DD'/><ellipse cx='26' cy='19' rx='2.2' ry='4' fill='%23FFC8DD'/><ellipse cx='19' cy='25' rx='4' ry='3' fill='%23FF6B9E'/></svg>" },
        { name: "ç‹„æ–¯", num: "22222", avatar: "data:image/svg+xml;utf8,<svg width='38' height='38' xmlns='http://www.w3.org/2000/svg'><ellipse cx='19' cy='23' rx='10' ry='12' fill='%23FFC8DD' stroke='%23704241' stroke-width='2.4'/><rect x='14' y='6' width='3' height='12' rx='1.1' fill='%23FFE6F2'/><rect x='21' y='6' width='3' height='12' rx='1.1' fill='%23FFE6F2'/></svg>" },
        { name: "æ‰£1å®¶äº§å¤æ´»", num: "33333", avatar: "data:image/svg+xml;utf8,<svg width='38' height='38' xmlns='http://www.w3.org/2000/svg'><ellipse cx='19' cy='20' rx='12' ry='13' fill='%23FFC8DD' stroke='%23704241' stroke-width='2.8'/><ellipse cx='13' cy='19' rx='2.4' ry='4' fill='%23FFE6F2'/><ellipse cx='25' cy='19' rx='2.4' ry='4' fill='%23FFE6F2'/><ellipse cx='19' cy='25' rx='4' ry='3' fill='%23FF8EAF'/></svg>" },
      ];
    }
    
    function showContacts() {
      var contacts = getContacts();
      var box = document.getElementById('contacts-list');
      if(!box) return;
      box.innerHTML = '';
      contacts.forEach(function(c,i){
        box.innerHTML += 
          `<li style="display:flex;align-items:center;margin-bottom:8px;"><img src="${c.avatar}" class="contact-avatar" alt="å¤´åƒ"><span style="font-weight:bold;color:#FF6B9E;">${c.name}</span><span style="color:#704241;margin-left:8px;font-size:0.97em;">${c.num}</span>
          <button class="pixel-btn" style="padding:2px 11px;font-size:0.89em;margin-left:auto;" onclick="callContact('${c.num}','${c.name}')">é€šè¯</button></li>`;
      });
    }
    
    function getContactName(num) {
      var contacts = getContacts();
      var c = contacts.find(c=>c.num===num);
      return c ? c.name : '';
    }
    
    function callContact(num, name) {
      // ä»è”ç³»äººæ‹¨æ‰“æ—¶ä¹Ÿç”Ÿæˆå¸¦æ—¶é•¿çš„é€šè¯è®°å½•
      var list = [];
      try { list = JSON.parse(localStorage.getItem('call-history')||'[]'); } catch(e) { list = []; }
      var now = new Date();
      
      // éšæœºç”Ÿæˆ1-60ç§’çš„é€šè¯æ—¶é•¿
      var durationSeconds = Math.floor(Math.random() * 60) + 1;
      var duration = {
        minutes: Math.floor(durationSeconds / 60),
        seconds: durationSeconds % 60
      };
      
      // æ·»åŠ é€šè¯è®°å½•
      list.unshift({
        num: num, 
        time: now.toLocaleString(), 
        contact: name,
        callTime: now.toTimeString().substr(0,8), // ç²¾ç¡®åˆ°ç§’
        date: now.toLocaleDateString(),
        type: "å‘¼å‡º", // é€šè¯ç±»å‹ï¼šå‘¼å‡º
        duration: duration
      });
      
      localStorage.setItem('call-history', JSON.stringify(list));
      
      // æ˜¾ç¤ºèŒç³»æç¤º
      alert(`å·²æ‹¨æ‰“ ${name} çš„ç”µè¯~ğŸ“\né€šè¯æ—¶é•¿ï¼š${duration.minutes}åˆ†${duration.seconds}ç§’âœ¨`);
      
      // å¦‚æœå½“å‰åœ¨ç”µè¯åº”ç”¨ï¼Œæ›´æ–°é€šè¯è®°å½•æ˜¾ç¤º
      if (document.getElementById('app-phone').style.display === 'block') {
        showCallHistory();
      }
    }
    
    function showContactHistory(num, name) {
      var list = [];
      try { list = JSON.parse(localStorage.getItem('call-history')||'[]'); } catch(e) { list = []; }
      var box = document.getElementById('contact-call-history');
      if(!box) return;
      
      // è·å–è¯¥è”ç³»äººçš„æ‰€æœ‰é€šè¯è®°å½•
      var contactCalls = list.filter(rec=>rec.num===num);
      
      // å¦‚æœæ²¡æœ‰é€šè¯è®°å½•ï¼Œæ˜¾ç¤ºå¯çˆ±æç¤º
      if (contactCalls.length === 0) {
        box.innerHTML = `<div style="margin-bottom:4px;font-size:1.05em;color:#FF6B9E;">${name} çš„é€šè¯è®°å½•</div>
        <div style="text-align: center; color: #FFC8DD; font-size: 0.9em;">è¿˜æ²¡æœ‰å’Œ${name}çš„é€šè¯è®°å½•å‘¢~ğŸ“±</div>`;
        return;
      }
      
      // æ ¼å¼åŒ–æ˜¾ç¤ºé€šè¯è®°å½•
      var callsHtml = contactCalls.map(rec=>{
        // æ ¼å¼åŒ–é€šè¯æ—¶é•¿
        var durationText = '';
        if(rec.duration) {
          var minutes = rec.duration.minutes;
          var seconds = rec.duration.seconds;
          if(minutes > 0) {
            durationText = `${minutes}åˆ†${seconds}ç§’`;
          } else {
            durationText = `${seconds}ç§’`;
          }
        } else {
          // ä¸ºæ—§è®°å½•æ·»åŠ é»˜è®¤æ—¶é•¿
          durationText = `${Math.floor(Math.random() * 5) + 1}åˆ†${Math.floor(Math.random() * 60)}ç§’`;
        }
        
        // é€‰æ‹©å¯çˆ±çš„emoji
        var callEmoji = rec.type === 'å‘¼å‡º' ? 'ğŸ“' : 'ğŸ“²';
        var cuteEmoji = ['âœ¨', 'ğŸŒŸ', 'ğŸ’«', 'â­'][Math.floor(Math.random() * 4)];
        
        return `<li style="margin-bottom:4px;">
          <span style="color:#FFC8DD;font-size:1.1em;">${callEmoji}</span> 
          <span style="color:#5A3B38;">${rec.num}</span> 
          <span style="font-size:0.85em;color:#FF6B9E;margin-left:8px;">${cuteEmoji} ${durationText}</span>
          <span style="font-size:0.85em;color:#704241;margin-left:8px;">[${rec.type || 'å‘¼å‡º'}]</span>
          <span style="float:right;font-size:0.93em;color:#704241;">â° ${rec.callTime || (rec.time && rec.time.length>=16 ? rec.time.substr(11,8):'')}</span>
        </li>`;
      }).join('');
      
      box.innerHTML = `<div style="margin-bottom:4px;font-size:1.05em;color:#FF6B9E;">${name} çš„é€šè¯è®°å½•</div><ul style="list-style:none;padding-left:0;">${callsHtml}</ul>`;
    }
    showContacts();

    // ========== æ—¥ç¨‹è¡¨åº”ç”¨ï¼ˆæ·»åŠ æ—¥æœŸé€‰ä¸­æ ‡è¯†ï¼‰ ===========
    let calendarDayTS = (()=>{
      let now = new Date();
      now.setHours(0,0,0,0);
      return now.getTime();
    })();
    
    // ä¿®å¤æ—¥å†ç‚¹å‡»äº‹ä»¶çš„è¯­æ³•é”™è¯¯
    function renderCalendarGrid() {
      const now = new Date(calendarDayTS);
      const selectedDate = new Date(calendarDayTS);
      const year = now.getFullYear();
      const month = now.getMonth();
      const day = now.getDate();
      
      // è·å–å½“æœˆç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå‡ 
      const firstDay = new Date(year, month, 1).getDay();
      // è·å–å½“æœˆå¤©æ•°
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      // è·å–ä»Šæ—¥æ—¥æœŸ
      const today = new Date();
      const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;
      
      let html = '';
      // æ˜ŸæœŸæ ‡é¢˜
      const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
      weekdays.forEach(wd => {
        html += `<div class="calendar-day">${wd}</div>`;
      });
      
      // ä¸Šä¸ªæœˆçš„æœ€åå‡ å¤© - ä¿®å¤è¯­æ³•é”™è¯¯
      const lastMonthDays = new Date(year, month, 0).getDate();
      for (let i = firstDay - 1; i >= 0; i--) {
        html += `<div class="calendar-date other" onclick="selectCalendarDate(${year}, ${month - 1}, ${lastMonthDays - i})">${lastMonthDays - i}</div>`;
      }
      
      // å½“æœˆå¤©æ•°ï¼ˆæ·»åŠ ç‚¹å‡»äº‹ä»¶å’Œé€‰ä¸­æ ·å¼ï¼‰
      for (let i = 1; i <= daysInMonth; i++) {
        const isToday = isCurrentMonth && i === today.getDate();
        const isSelected = i === day;
        let className = 'calendar-date';
        if (isToday) className += ' today';
        if (isSelected && !isToday) className += ' selected';
        
        html += `<div class="${className}" onclick="selectCalendarDate(${year}, ${month}, ${i})">${i}</div>`;
      }
      
      // ä¸‹ä¸ªæœˆçš„å¼€å¤´å‡ å¤©
      const totalCells = 42; // 6è¡Œ7åˆ—
      const remaining = totalCells - (firstDay + daysInMonth);
      for (let i = 1; i <= remaining; i++) {
        html += `<div class="calendar-date other" onclick="selectCalendarDate(${year}, ${month + 1}, ${i})">${i}</div>`;
      }
      
      document.getElementById('calendar-grid').innerHTML = html;
    }
    
    // é€‰æ‹©æ—¥å†æ—¥æœŸ
    function selectCalendarDate(year, month, day) {
      const selectedDate = new Date(year, month, day);
      selectedDate.setHours(0, 0, 0, 0);
      calendarDayTS = selectedDate.getTime();
      updateCalendarDate();
      showCalendar();
      renderCalendarGrid(); // é‡æ–°æ¸²æŸ“ä»¥æ˜¾ç¤ºé€‰ä¸­çŠ¶æ€
    }
    
    function updateCalendarDate() {
      var d = new Date(calendarDayTS);
      document.getElementById('calendar-date-label').textContent = `${d.getFullYear()}-${('0'+(d.getMonth()+1)).slice(-2)}-${('0'+d.getDate()).slice(-2)}`;
    }
    
    // ä¿®æ”¹ï¼šä¼˜åŒ–æ—¥ç¨‹åˆ—è¡¨æ˜¾ç¤ºï¼Œç¡®ä¿åˆ é™¤æŒ‰é’®å›ºå®šåœ¨å³ä¾§
    function showCalendar() {
      var d = new Date(calendarDayTS);
      var key = 'calendar-'+d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate();
      var list = [];
      try { list = JSON.parse(localStorage.getItem(key)||'[]'); } catch(e) { list = []; }
      var box = document.getElementById('calendar-list');
      if(!box) return;
      box.innerHTML='';
      for(let i=0;i<list.length;++i){
        box.innerHTML += `<div class="calendar-item">
          <div class="calendar-item-text">
            <span style="color:#FF6B9E;">â˜…</span> <span>${list[i]}</span>
          </div>
          <button class="pixel-btn" style="padding:2px 8px;font-size:0.88em;" onclick="deleteCalendar(${i})">åˆ é™¤</button>
        </div>`;
      }
    }
    
    function addCalendar() {
      var inp = document.getElementById('calendar-input');
      var v = inp.value.trim();
      if(!v) return;
      var d = new Date(calendarDayTS);
      var key = 'calendar-'+d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate();
      var list = [];
      try { list = JSON.parse(localStorage.getItem(key)||'[]'); } catch(e) { list = []; }
      list.push(v);
      localStorage.setItem(key, JSON.stringify(list));
      inp.value = '';
      showCalendar();
    }
    
    function deleteCalendar(idx) {
      var d = new Date(calendarDayTS);
      var key = 'calendar-'+d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate();
      var list = [];
      try { list = JSON.parse(localStorage.getItem(key)||'[]'); } catch(e) { list = []; }
      list.splice(idx,1);
      localStorage.setItem(key, JSON.stringify(list));
      showCalendar();
    }
    
    function changeDate(dlt) {
      calendarDayTS += dlt*24*60*60*1000;
      updateCalendarDate();
      showCalendar();
      renderCalendarGrid(); // åˆ‡æ¢æ—¥æœŸæ—¶é‡æ–°æ¸²æŸ“æ—¥å†
    }
    
    // åˆå§‹åŒ–12æœˆ4æ—¥è‡³7æ—¥çš„é»˜è®¤æ—¥ç¨‹
    function initDefaultCalendar() {
      // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
      if (localStorage.getItem('calendar-initialized')) {
        return;
      }
      
      const events = ["åˆ·æŠ–éŸ³", "ç»™å…”çš‡ç“œæ¡ç‚¹èµ", "obå…”çš‡æ¯”èµ›", "å­¦æ•°æ¨¡ç”µ", "åœ¨å˜‰ç«‹åˆ›ä¸‹å•", "çœ‹åçµ®å§wb", "çœ‹wbè®¿å®¢è®°å½•"];
      const dates = [4, 5, 6, 7]; // 12æœˆ4æ—¥è‡³7æ—¥
      
      // éšæœºæ‰“ä¹±äº‹ä»¶é¡ºåº
      const shuffledEvents = events.sort(() => Math.random() - 0.5);
      
      // ä¸ºæ¯ä¸ªæ—¥æœŸåˆ†é…äº‹ä»¶ï¼Œæ¯å¤©1-2ä¸ª
      dates.forEach((date, dateIndex) => {
        const key = `calendar-2024-12-${String(date).padStart(2, '0')}`;
        let dayEvents = [];
        
        // æ¯å¤©åˆ†é…1-2ä¸ªäº‹ä»¶
        const eventCount = Math.floor(Math.random() * 2) + 1;
        for (let i = 0; i < eventCount; i++) {
          if (shuffledEvents.length > 0) {
            dayEvents.push(shuffledEvents.pop());
          }
        }
        
        localStorage.setItem(key, JSON.stringify(dayEvents));
      });
      
      // æ ‡è®°ä¸ºå·²åˆå§‹åŒ–
      localStorage.setItem('calendar-initialized', 'true');
    }
    
    // æ‰§è¡Œåˆå§‹åŒ–
    initDefaultCalendar();
    
    updateCalendarDate();
    showCalendar();
    renderCalendarGrid(); // åˆå§‹åŒ–æ¸²æŸ“æ—¥å†
  </script>
</body>
</html>
